{"version":1,"ops":[{"type":2,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1579809120,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjk3NTA1MDQ4Nw=="},"title":"Patchfox feels much faster","was":"Patchfox feels much faster"},{"type":3,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1579809264,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzg0NzM1OQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577847359"},"message":"Firefox on my 13\" laptop takes 15 seconds to render the inbox html","files":null},{"type":3,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1579809398,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzg0ODM4OQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577848389"},"message":"Weight of modules on disk\n```\n┌──────────────────────┬──────────────┬─────────┐\n│ name                 │ children     │ size    │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-client           │ 75           │ 39.15M  │\n├──────────────────────┼──────────────┼─────────┤\n│ @fraction/flotilla   │ 694          │ 33.99M  │\n├──────────────────────┼──────────────┼─────────┤\n│ sharp                │ 87           │ 32.90M  │\n├──────────────────────┼──────────────┼─────────┤\n│ require-style        │ 124          │ 12.18M  │\n├──────────────────────┼──────────────┼─────────┤\n│ highlight.js         │ 9            │ 6.59M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-markdown         │ 15           │ 2.64M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-mentions         │ 4            │ 2.11M   │\n├──────────────────────┼──────────────┼─────────┤\n│ koa-body             │ 13           │ 1.35M   │\n├──────────────────────┼──────────────┼─────────┤\n│ lodash               │ 0            │ 1.34M   │\n├──────────────────────┼──────────────┼─────────┤\n│ koa                  │ 46           │ 1.04M   │\n├──────────────────────┼──────────────┼─────────┤\n│ yargs                │ 37           │ 0.81M   │\n├──────────────────────┼──────────────┼─────────┤\n│ koa-static           │ 19           │ 0.57M   │\n├──────────────────────┼──────────────┼─────────┤\n│ koa-router           │ 9            │ 0.52M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-ref              │ 12           │ 0.48M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-config           │ 11           │ 0.21M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-thread-schema    │ 11           │ 0.16M   │\n├──────────────────────┼──────────────┼─────────┤\n│ hyperaxe             │ 7            │ 0.15M   │\n├──────────────────────┼──────────────┼─────────┤\n│ koa-mount            │ 5            │ 0.12M   │\n├──────────────────────┼──────────────┼─────────┤\n│ debug                │ 1            │ 0.09M   │\n├──────────────────────┼──────────────┼─────────┤\n│ pull-sort            │ 2            │ 0.08M   │\n├──────────────────────┼──────────────┼─────────┤\n│ pull-stream          │ 0            │ 0.07M   │\n├──────────────────────┼──────────────┼─────────┤\n│ @fraction/base16-css │ 0            │ 0.05M   │\n├──────────────────────┼──────────────┼─────────┤\n│ open                 │ 1            │ 0.04M   │\n├──────────────────────┼──────────────┼─────────┤\n│ ssb-msgs             │ 1            │ 0.04M   │\n├──────────────────────┼──────────────┼─────────┤\n│ pull-paramap         │ 1            │ 0.02M   │\n├──────────────────────┼──────────────┼─────────┤\n│ pretty-ms            │ 1            │ 0.02M   │\n├──────────────────────┼──────────────┼─────────┤\n│ 26 modules           │ 510 children │ 106.00M │\n└──────────────────────┴──────────────┴─────────┘\n```","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579809868,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzg1MTkzMg==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577851932"},"message":"Yep, I haven't spent any time focusing on performance and there are lots of low-hanging fruit. These low-hanging fruit have made development faster, but are definitely worth fixing. List of optimizations I'd like to make:\n\n- when we resize the image thumbnail it might be worth caching it so we don't resize every thumbnail a million times\n- `await` has been overused and has made parallelization a pain, we need `Promise.all()` pretty much everywhere\n- model methods pull completely new data every time instead of caching anything\n  - we could cache to the filesystem for SUPER SPEED but even just caching in memory would be cool\n- we should probably stream HTTP output instead of waiting for the full page to be finished\n\nTo be specific, the inbox is *super slow* because it's literally just streaming all private messages until it finds the latest message from the past ~60 threads. The more often you use private messages the faster the view is, but for me it's streaming 6 months of messages to find the oldest one. The 'popular' pages are doing similar work, so they're also super slow.","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579817402,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3NzkwMTE2OA==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577901168"},"message":"Also on the \"HTTP requests are kinda slow\" front, I've been trying to find [a framework like this](https://github.com/christianbundy/http-spa) but I can't find one. Most of Oasis would work 100% fine if it was distributed as a single-page web app (plus it would be easy to demo!) without an actual HTTP server, but I want to leverage an existing technology instead of writing my own.\n\nIf you know of a tool that would let us port Oasis to an SPA, that might be super helpful.","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579817549,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3NzkwMjAyOA==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577902028"},"message":"Also, because I want to be super super super clear: I think we should prioritize a simple boring HTTP server and probably use it for debugging, but it would be cool to have the *option* of exporting some standalone `index.html` that runs Oasis too.","files":null},{"type":5,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579822437,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI5NzU2NTMyNjI="},"added":["topic:enhancement"],"removed":[]},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579822835,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3NzkyOTEyMA==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577929120"},"message":"Relevant for optimizations: https://oasis-demo.fraction.io/thread/%250zK8uZhwMESGFkkf3svywT5cGe6V%2B9qIqHKW5ufLG00%3D.sha256#%250zK8uZhwMESGFkkf3svywT5cGe6V%2B9qIqHKW5ufLG00%3D.sha256\n\nFor example, on `/public/latest`:\n\n- Subscribe to the list of messages and hold the latest `$max` in memory\n- When the page is requested, respond with what we have in memory\n- When a new message comes through the stream, remove old messages to keep only `$max` in memory\n\nUnfortunately this gets more complicated in `/public/popular/day` and such, because if Oasis is online for 2 days we want to make sure we aren't counting votes from previous days. The current implementation prefers simplicity over speed, but we can fix that. :~)","files":null},{"type":3,"author":{"id":"15be4af55ad83e3dbe17b7c1fb3a4889aa5fa3cd"},"timestamp":1579826584,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzk0NDY4Mw==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577944683"},"message":"If it was a SPA standalone index.html, would it still need an ssb-client outside the browser?  Is it possible to run all of scuttlebutt in a browser?","files":null},{"type":3,"author":{"id":"15be4af55ad83e3dbe17b7c1fb3a4889aa5fa3cd"},"timestamp":1579828959,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzk1MzM2Mg==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577953362"},"message":"I added an experimental branch to mitigate page slowness using turbolinks.js #77","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579829491,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Nzk1NTIyMQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-577955221"},"message":"\u003e If it was a SPA standalone index.html, would it still need an ssb-client outside the browser? If it was a SPA standalone index.html, would it still need an ssb-client outside the browser? \n\nI'm not sure that I understand the first question, could you rephrase or add more background info? Regarding the second question, I think yes, because I *think* that's what @arj03 is doing with [SSB-Browser](https://github.com/arj03/ssb-browser-demo), but when I tried to browserify SSB-DB it blew up in my face. :man_shrugging: I think SSB is *supposed* to be able to be run in a browser, and I think [my first comment about SSB on GitHub](https://github.com/ssbc/ssb-db/issues/179#issuecomment-315939927) was about this use-case, but I don't know how things are going with that.","files":null},{"type":3,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1579844928,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODAwMDQ1OA==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578000458"},"message":"I was thinking of https://developer.mozilla.org/en-US/docs/Web/HTTP/Link_prefetching_FAQ","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579848720,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODAxMzQwNQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578013405"},"message":"I really like that idea, I'd be happy to add *at least* the navigation links to be pre-fetched.","files":null},{"type":3,"author":{"id":"6d7fabb6c9337562e5c6c1006a3c38d299b4eca6"},"timestamp":1579855603,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODA0MjQyMg==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578042422"},"message":"@christianbundy ssb-db takes a bit more work to run in the browser. There is a branch which was the starting point for [ssb-browser-core](https://github.com/arj03/ssb-browser-core). Also there is a lot of details like blobs that browser core takes care of. I'm quite happy that it made it to a point where I can add some documentation to make it easier for other people to experiment with clients. [Browser demo](https://github.com/arj03/ssb-browser-demo/tree/master/ui) is around 1500 lines js and that includes the html as its written in vue. Also PWA is great for startup performance because it will load things from cache always and then only afterwards see if the cache is stale.\n\nAnd sorry for hijacking this thread :D","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1579880954,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODE4NjExMg==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578186112"},"message":"Awesome, thanks for that info! Do you think that SSB-DB will go back to being platform-agnostic? I could've sworn that we used to be able to browserify it, but it isn't working for me anymore. One of the things I'm trying to do is make sure I'm running the same code in both environments, so that Oasis contributors don't have to worry about whether it's over HTTP or an SPA, but it looks like maybe ssb-browser-core is an alternative to SSB-Server -- is that right?","files":null},{"type":3,"author":{"id":"6d7fabb6c9337562e5c6c1006a3c38d299b4eca6"},"timestamp":1579899377,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODI5ODUyMQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578298521"},"message":"In time it will I think. I pushed a few fixes to some of the libraries needed, but on the other hand, having something that only runs in the browser makes it possible to run things like https://github.com/dominictarr/flumelog-aligned-offset without having to worry about backwards compatibility.\n\nAnd yeah ssb-browser-core is probably closer to ssb-server than ssb-db.","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1580072871,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODU0MzIzNQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578543235"},"message":"Cool, thanks for all the info @arj03 -- I saw that you mentioned that you're working on something cool on SSB, I'm excited to see what it is. I'm suspicious that it has to do with SSB-Browser.\n\n---\n\n@jedahan Just improved the speed of the inbox page with #79, hope that helps a bit for you! Are there any other big performance hiccups that we should address before closing this issue?","files":null},{"type":3,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1580101817,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODU5MzgwNw==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578593807"},"message":"I spent some time trying to get prefetching working, but had zero success. Happy to close this issue since 'patchfox feels faster' is a bit too broad an issue, and I'd rather pinpoint specific places for performance improvment than something this general. Will test out #79 shortly!","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1580101918,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODU5NDEzOQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578594139"},"message":"Woop! Thanks for bringing this up, looking forward to future performance challenges. :eyes:","files":null},{"type":4,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1580101918,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mjk4MDUyNzQxNA=="},"status":2},{"type":3,"author":{"id":"4f506d936028410197b6fff70b94c3833432a95b"},"timestamp":1580102108,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3ODU5NDcxNQ==","github-url":"https://github.com/fraction/oasis/issues/71#issuecomment-578594715"},"message":"wow that went from 15 seconds to \u003c1s, awesome job!","files":null}]}