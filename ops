{"version":1,"ops":[{"type":5,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1562709319,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI0NzA3NzgzMTM="},"added":["topic:enhancement"],"removed":[]},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1562710236,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUwOTgyODgyNA==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-509828824"},"message":"I think that's a good call, for `{ type: 'vote' }` messages I gave them their own HTTP endpoint but it might be nicer to just have a single endpoint for all message publishing.","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1562710380,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUwOTgyOTQ3NQ==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-509829475"},"message":"e.g. the `/like` HTTP endpoint:\n\nhttps://github.com/fraction/oasis/blob/8713777b6aa42bc974323e30ad3b66ef311734c8/src/pages/like.js#L3-L6\n\nWhich uses the *vote* model:\n\nhttps://github.com/fraction/oasis/blob/8713777b6aa42bc974323e30ad3b66ef311734c8/src/pages/models/vote.js#L4-L13","files":null},{"type":3,"author":{"id":"9021ca3e4c742b59e6879a829fbe093e2fdb3d2e"},"timestamp":1562989861,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxMTA4NTI3OA==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-511085278"},"message":"this is how I did it in yap,\nhttps://github.com/dominictarr/yap/blob/master/index.js#L86-L102\n\nI havn't done attachments yet... looking at this again I realize I have two separate routes for setting cookies - identitySelect and languageSelect should just be \"cookie\"","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1570046018,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUzNzY1Mjc4Mw==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-537652783"},"message":"Should we be mindful of CSRF? I'm thinking about HTML blobs that are going to be running on localhost, which would give an attacker the ability to submit forms to `/apis/publish` and such.","files":null},{"type":3,"author":{"id":"9021ca3e4c742b59e6879a829fbe093e2fdb3d2e"},"timestamp":1570136662,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUzODEyODAxNg==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-538128016"},"message":"yes definitely. blobs should be returned with pretty hard CSP settings","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1572449398,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0Nzk2NTIzMw==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-547965233"},"message":"I think I have this resolved by using strict CSP (no JS, only CSS/media/forms from own domain) and  enforcing a referrer check on all non-GET endpoints to ensure that they aren't coming from a blob URL.  I *think* this provides a guarantee that external domains can't access Oasis and blobs can't run JS or make [non-GET] HTTP requests.","files":null},{"type":3,"author":{"id":"9021ca3e4c742b59e6879a829fbe093e2fdb3d2e"},"timestamp":1572459419,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0ODA0NjM5OA==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-548046398"},"message":"can you point me to your CSP code?","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1572461073,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0ODA1ODU2Mg==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-548058562"},"message":"Yeah, all of the relevant code is here: https://github.com/fraction/oasis/blob/b8691d7671afdd62a7f37bf5b94779def30174da/src/app.js#L53-L83\n\nI used `default-src` to disallow everything by default, and manually allowed images, audio/video, and CSS from the same protocol + host + port. The `form-src` tightens down which domains are allowed to send form submissions, and then at the bottom of the code I'm ensuring that the referrer URL exists and doesn't start with `/blob/`.","files":null},{"type":6,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1572461073,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMTMzNTIwMg=="},"target":"3a057a595c519161d93b8a16a7fad8d085b9f48eba1d141a145e659ca4511d5e","message":"Yeah, all of the relevant code is here: https://github.com/fraction/oasis/blob/b8691d7671afdd62a7f37bf5b94779def30174da/src/app.js#L53-L83\n\nI used `default-src` to disallow everything by default, and manually allowed images, audio/video, and CSS from the same protocol + host + port. The `form-action` tightens down which domains are allowed to send form submissions, and then at the bottom of the code I'm ensuring that the referrer URL exists and doesn't start with `/blob/`.","files":null},{"type":3,"author":{"id":"9021ca3e4c742b59e6879a829fbe093e2fdb3d2e"},"timestamp":1572489081,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0ODE5MTEzMA==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-548191130"},"message":"that all looks pretty good. did you do any research to come up with this? this is a security thing and you need to get it right the first time. there are probably blog posts about common mistakes...","files":null},{"type":3,"author":{"id":"6a0aeab8ae8e7bf93407c51e9b2a4d9d0273c9ad"},"timestamp":1572562381,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0ODYwMDM0Nw==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-548600347"},"message":"Yeah, I've written a bunch of CSPs for proprietary projects (woo) and usually start with the recommendations from [securityheaders.com](https://securityheaders.com/?q=oasis-demo.fraction.io\u0026followRedirects=on), but I've also read through the [OWASP CSRF guide](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)) and a handful of the attached pages.\n\nI couldn't find any guides for safely hosting arbitrary HTML on `localhost`, so if you see any I'd be keen to read them. Having a JS-free front-end makes this much simpler than it would be in a conventional application, but I'd still like to make sure all the holes are plugged.","files":null},{"type":3,"author":{"id":"9021ca3e4c742b59e6879a829fbe093e2fdb3d2e"},"timestamp":1572855974,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0OTI1ODAxMQ==","github-url":"https://github.com/fraction/oasis/issues/5#issuecomment-549258011"},"message":"hmm, I guess the answer is to invoke [cunningham's law](https://meta.wikimedia.org/wiki/Cunningham%27s_Law): write that blog post your self, and let somebody post it on hacker news","files":null}]}